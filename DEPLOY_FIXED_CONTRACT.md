# éƒ¨ç½²ä¿®å¤åçš„åˆçº¦ - å®Œæ•´æŒ‡å—


**ç›®çš„**: éƒ¨ç½²ä¿®å¤äº†é›¶æŠ•ç¥¨ææ¡ˆé—®é¢˜çš„æ–°åˆçº¦

---

## âš ï¸ **å½“å‰çŠ¶å†µ**

### **é—®é¢˜æ€»ç»“**

æ—§åˆçº¦ `0x6Ece9C29F6E47876bC3809BAC99c175273E184aB` æœ‰ä¸€ä¸ªè®¾è®¡ç¼ºé™·ï¼š

- **é—®é¢˜**: å½“ææ¡ˆæ²¡æœ‰ä»»ä½•æŠ•ç¥¨æ—¶ï¼Œ`endProposal()` å‡½æ•°æ— æ³•æ­£å¸¸å·¥ä½œ
- **åŸå› **: `FHE.requestDecryption([])` ä¼ å…¥ç©ºæ•°ç»„ä¼šå¤±è´¥
- **åæœ**: æ— æ³•ç»“æŸé›¶æŠ•ç¥¨ææ¡ˆï¼Œé˜»æ­¢åˆ›å»ºæ–°ææ¡ˆ

### **è§£å†³æ–¹æ¡ˆ**

éƒ¨ç½²ä¿®å¤åçš„åˆçº¦ `AnonymousPropertyVotingFixed.sol`ï¼Œè¯¥åˆçº¦ï¼š

âœ… æ£€æŸ¥ææ¡ˆæ˜¯å¦æœ‰æŠ•ç¥¨
âœ… é›¶æŠ•ç¥¨æ—¶ç›´æ¥å®Œæˆææ¡ˆï¼ˆä¸è°ƒç”¨ FHEï¼‰
âœ… æœ‰æŠ•ç¥¨æ—¶æ­£å¸¸ä½¿ç”¨ FHE è§£å¯†

---

## ğŸ’° **èµ„é‡‘éœ€æ±‚**

### **å½“å‰ä½™é¢**

```
Account: 0x9b97D523dc876Cc79bF255E531508A0293De9158
Balance: 0.028 ETH
Required: ~0.047 ETH
Shortage: ~0.019 ETH
```

### **ä¸ºä»€ä¹ˆéœ€è¦æ›´å¤šèµ„é‡‘ï¼Ÿ**

éƒ¨ç½²åˆçº¦éœ€è¦ Gas è´¹ç”¨ï¼š
- åˆçº¦å¤§å°: ~9.56 KiB
- Gas ä¼°ç®—: ~2,300,000 gas
- Gas Price: 20 Gwei
- **æ€»æˆæœ¬**: 2,300,000 Ã— 20 = 46,000,000 Gwei = 0.046 ETH

### **è·å–æµ‹è¯•å¸**

ä»ä»¥ä¸‹æ°´é¾™å¤´è·å– Sepolia ETHï¼ˆå…è´¹ï¼‰ï¼š

1. **Sepolia Faucet** (æ¨è)
   - https://sepoliafaucet.com/
   - æ¯24å°æ—¶å¯é¢†å– 0.5 ETH

2. **QuickNode Faucet**
   - https://faucet.quicknode.com/ethereum/sepolia
   - æ¯å¤© 0.1 ETH

3. **Alchemy Sepolia Faucet**
   - https://sepoliafaucet.com/
   - éœ€è¦ Alchemy è´¦å·

4. **Chainlink Faucet**
   - https://faucets.chain.link/sepolia
   - éœ€è¦è¿æ¥é’±åŒ…

### **æ­¥éª¤**

1. è®¿é—®ä»»ä¸€æ°´é¾™å¤´ç½‘ç«™
2. è¿æ¥ MetaMask é’±åŒ…
3. ç¡®è®¤é’±åŒ…åœ°å€: `0x9b97D523dc876Cc79bF255E531508A0293De9158`
4. ç‚¹å‡» "Send Me ETH" æˆ–ç±»ä¼¼æŒ‰é’®
5. ç­‰å¾…1-2åˆ†é’Ÿåˆ°è´¦
6. æ£€æŸ¥ä½™é¢: `npx hardhat run scripts/checkBalance.js --network sepolia`

---

## ğŸš€ **éƒ¨ç½²æ­¥éª¤**

### **å‰ææ¡ä»¶æ£€æŸ¥**

- [ ] å·²è·å–è¶³å¤Ÿçš„ Sepolia ETH (è‡³å°‘ 0.05 ETH)
- [ ] å·²ç¼–è¯‘åˆçº¦ (`npx hardhat compile`)
- [ ] å·²é…ç½® `env` æ–‡ä»¶ï¼ˆåŒ…å« RPC_URL å’Œ PRIVATE_KEYï¼‰
- [ ] ç¡®è®¤è´¦æˆ·æœ‰æƒé™ï¼ˆæ˜¯ç®¡ç†å‘˜è´¦æˆ·ï¼‰

### **æ­¥éª¤ 1: æ£€æŸ¥ä½™é¢**

```bash
cd D:
npx hardhat run scripts/deployFixed.js --network sepolia --dry-run
```

### **æ­¥éª¤ 2: æ‰§è¡Œéƒ¨ç½²**

```bash
npx hardhat run scripts/deployFixed.js --network sepolia
```

**é¢„æœŸè¾“å‡º**ï¼š

```
=== Deploying Fixed Contract ===

Deploying contracts with account: 0x9b97D523dc876Cc79bF255E531508A0293De9158
Account balance: 0.08 ETH

ğŸ“¦ Deploying AnonymousPropertyVotingFixed...

âœ… Contract deployed successfully!

ğŸ“‹ Contract Details:
  Address: 0x...  â† æ–°åˆçº¦åœ°å€
  Transaction Hash: 0x...
  Block Number: 9452XXX
  Deployer (Property Manager): 0x9b97D523dc876Cc79bF255E531508A0293De9158

ğŸ”— View on Etherscan:
  https://sepolia.etherscan.io/address/0x...

âš™ï¸  Next Steps:
  1. Update public/config.js with new contract address:
     CONTRACT_ADDRESS: "0x..."
  2. Refresh your frontend (Ctrl + F5)
  3. Reconnect your wallet
  4. Register as resident again
  5. Test creating proposals (with and without votes)

ğŸ“ Saving deployment info...
âœ… Deployment info saved to deployment-fixed.json

ğŸ‰ Deployment complete!
```

### **æ­¥éª¤ 3: æ›´æ–°å‰ç«¯é…ç½®**

ç¼–è¾‘ `D:\public\config.js`ï¼š

```javascript
const CONFIG = {
    CONTRACT_ADDRESS: "0xæ–°åˆçº¦åœ°å€",  // â† æ›¿æ¢è¿™é‡Œ
    NETWORK: {
        CHAIN_ID: 11155111,
        CHAIN_ID_HEX: "0xaa36a7",
        NAME: "Sepolia Testnet",
        RPC_URL: "https://rpc.sepolia.org",
        EXPLORER_URL: "https://sepolia.etherscan.io"
    },
    ABI: [
        // ... ä¿æŒä¸å˜
    ]
};
```

### **æ­¥éª¤ 4: éªŒè¯éƒ¨ç½²**

1. **åœ¨ Etherscan ä¸ŠæŸ¥çœ‹**ï¼š
   ```
   https://sepolia.etherscan.io/address/[æ–°åˆçº¦åœ°å€]
   ```

2. **æ£€æŸ¥åˆçº¦å‡½æ•°**ï¼š
   - ç‚¹å‡» "Contract" æ ‡ç­¾
   - ç‚¹å‡» "Read Contract"
   - æŸ¥çœ‹ `propertyManager()` â†’ åº”è¯¥æ˜¯ä½ çš„åœ°å€

### **æ­¥éª¤ 5: æµ‹è¯•å‰ç«¯**

1. åˆ·æ–°é¡µé¢: `Ctrl + F5`
2. é‡æ–°è¿æ¥é’±åŒ…
3. æ£€æŸ¥ "Admin Functions" éƒ¨åˆ†
4. æ³¨å†Œä¸ºå±…æ°‘
5. åˆ›å»ºæµ‹è¯•ææ¡ˆ

---

## ğŸ§ª **æµ‹è¯•ä¿®å¤**

### **æµ‹è¯•åœºæ™¯ 1: é›¶æŠ•ç¥¨ææ¡ˆ**

```
1. åˆ›å»ºææ¡ˆ "Test Zero Votes"
   âœ… æˆåŠŸåˆ›å»º

2. ç­‰å¾…1åˆ†é’Ÿï¼ˆæˆ–è®¾ç½®24å°æ—¶åï¼‰
   â° æŠ•ç¥¨æœŸæœªç»“æŸï¼Œæ— æ³•æµ‹è¯•

3. ç‚¹å‡» "End Expired Proposal"
   âŒ æç¤º "Voting still active"
```

**æ³¨æ„**: éœ€è¦ç­‰å¾…æŠ•ç¥¨æœŸç»“æŸæ‰èƒ½æµ‹è¯•ã€‚å¯ä»¥åˆ›å»º1å°æ—¶çš„çŸ­æœŸææ¡ˆã€‚

### **æµ‹è¯•åœºæ™¯ 2: æœ‰æŠ•ç¥¨çš„ææ¡ˆ**

```
1. åˆ›å»ºææ¡ˆ "Test With Votes"
   âœ… æˆåŠŸåˆ›å»º

2. ä½¿ç”¨å¦ä¸€ä¸ªè´¦æˆ·æŠ•ç¥¨
   âœ… æŠ• YES

3. ç­‰å¾…æŠ•ç¥¨æœŸç»“æŸ
   â° ç­‰å¾…...

4. ç‚¹å‡» "End Expired Proposal"
   âœ… åº”è¯¥æˆåŠŸ
   âœ… æ˜¾ç¤ºæŠ•ç¥¨ç»“æœ: 1 YES, 0 NO
```

### **æµ‹è¯•åœºæ™¯ 3: è¿ç»­åˆ›å»ºææ¡ˆ**

```
1. åˆ›å»ºææ¡ˆ A (æ— æŠ•ç¥¨)
   âœ… æˆåŠŸ

2. ç»“æŸææ¡ˆ A
   âœ… æˆåŠŸ

3. ç«‹å³åˆ›å»ºææ¡ˆ B
   âœ… åº”è¯¥æˆåŠŸ â† éªŒè¯ä¿®å¤

4. ç»“æŸææ¡ˆ B
   âœ… æˆåŠŸ

5. åˆ›å»ºææ¡ˆ C
   âœ… åº”è¯¥æˆåŠŸ
```

---

## ğŸ“Š **æ–°æ—§åˆçº¦å¯¹æ¯”**

| ç‰¹æ€§ | æ—§åˆçº¦ | æ–°åˆçº¦ (Fixed) |
|------|--------|----------------|
| é›¶æŠ•ç¥¨ææ¡ˆ | âŒ å¤±è´¥ | âœ… æˆåŠŸå¤„ç† |
| æœ‰æŠ•ç¥¨ææ¡ˆ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ |
| è¿ç»­åˆ›å»ºææ¡ˆ | âŒ é˜»å¡ | âœ… æµç•… |
| FHE åŠ å¯† | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| Gas æ•ˆç‡ | æ­£å¸¸ | ç•¥å¥½ï¼ˆè·³è¿‡ä¸å¿…è¦çš„ FHE è°ƒç”¨ï¼‰ |

---

## ğŸ”§ **æ•…éšœæ’æŸ¥**

### **é”™è¯¯ 1: "insufficient funds"**

**åŸå› **: è´¦æˆ·ä½™é¢ä¸è¶³

**è§£å†³**: ä»æ°´é¾™å¤´è·å–æ›´å¤š Sepolia ETH

### **é”™è¯¯ 2: "nonce too low"**

**åŸå› **: äº¤æ˜“ nonce å†²çª

**è§£å†³**:
```bash
# æ¸…é™¤ Hardhat ç¼“å­˜
rm -rf artifacts cache
npx hardhat clean
npx hardhat compile
```

### **é”™è¯¯ 3: "replacement fee too low"**

**åŸå› **: å°è¯•æ›¿æ¢å¾…å¤„ç†çš„äº¤æ˜“

**è§£å†³**: ç­‰å¾…ä¹‹å‰çš„äº¤æ˜“å®Œæˆï¼Œæˆ–æé«˜ gas price

### **é”™è¯¯ 4: éƒ¨ç½²åå‰ç«¯æ— æ³•è¿æ¥**

**æ£€æŸ¥**:
1. `config.js` ä¸­çš„åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®
2. ABI æ˜¯å¦åŒ¹é…ï¼ˆåº”è¯¥ç›¸åŒï¼‰
3. æµè§ˆå™¨æ§åˆ¶å°æœ‰æ— é”™è¯¯
4. æ˜¯å¦åˆ·æ–°äº†é¡µé¢ (Ctrl + F5)

---

## ğŸ“ **éƒ¨ç½²åæ¸…å•**

éƒ¨ç½²å®Œæˆåï¼ŒéªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

- [ ] åˆçº¦åœ¨ Etherscan ä¸Šå¯è§
- [ ] `propertyManager` æ˜¯ä½ çš„åœ°å€
- [ ] `currentProposal` åˆå§‹å€¼æ˜¯ 1
- [ ] å‰ç«¯å¯ä»¥è¿æ¥æ–°åˆçº¦
- [ ] å¯ä»¥æ³¨å†Œä¸ºå±…æ°‘
- [ ] å¯ä»¥åˆ›å»ºææ¡ˆ
- [ ] å¯ä»¥æŠ•ç¥¨
- [ ] å¯ä»¥ç»“æŸææ¡ˆï¼ˆé›¶æŠ•ç¥¨å’Œæœ‰æŠ•ç¥¨ï¼‰
- [ ] å¯ä»¥è¿ç»­åˆ›å»ºå¤šä¸ªææ¡ˆ

---

## ğŸ¯ **è¿ç§»æ³¨æ„äº‹é¡¹**

### **æ•°æ®è¿ç§»**

âš ï¸ **é‡è¦**: æ–°åˆçº¦æ˜¯å…¨æ–°çš„ï¼Œä¸åŒ…å«æ—§åˆçº¦çš„æ•°æ®ï¼š

- âŒ æ—§çš„å±…æ°‘æ³¨å†Œè®°å½•ä¸ä¼šè½¬ç§»
- âŒ æ—§çš„ææ¡ˆå†å²ä¸ä¼šè½¬ç§»
- âŒ æ—§çš„æŠ•ç¥¨è®°å½•ä¸ä¼šè½¬ç§»

**æ‰€æœ‰ç”¨æˆ·éœ€è¦é‡æ–°æ³¨å†Œï¼**

### **é€šçŸ¥ç”¨æˆ·**

å¦‚æœè¿™æ˜¯ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„åº”ç”¨ï¼Œéœ€è¦é€šçŸ¥æ‰€æœ‰ç”¨æˆ·ï¼š

```
é€šçŸ¥å†…å®¹ç¤ºä¾‹ï¼š

æ ‡é¢˜: ç³»ç»Ÿå‡çº§é€šçŸ¥

æˆ‘ä»¬å·²ç»éƒ¨ç½²äº†æ–°ç‰ˆæœ¬çš„æŠ•ç¥¨åˆçº¦ä»¥ä¿®å¤æŠ€æœ¯é—®é¢˜ã€‚

è¯·æ‰€æœ‰ç”¨æˆ·ï¼š
1. åˆ·æ–°é¡µé¢ (Ctrl + F5)
2. é‡æ–°è¿æ¥é’±åŒ…
3. é‡æ–°æ³¨å†Œä¸ºå±…æ°‘

æ—§åˆçº¦çš„æ•°æ®ä¸ä¼šè¿ç§»ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒï¼Œ
æ‰€æœ‰åŠŸèƒ½ç°åœ¨éƒ½å·²æ­£å¸¸å·¥ä½œã€‚

æ„Ÿè°¢æ‚¨çš„ç†è§£ï¼
```

---

## ğŸš€ **ç«‹å³æ‰§è¡Œ**

### **ç¬¬1æ­¥: è·å–æµ‹è¯•å¸**

```
è®¿é—®: https://sepoliafaucet.com/
åœ°å€: 0x9b97D523dc876Cc79bF255E531508A0293De9158
é‡‘é¢: è‡³å°‘ 0.05 ETH
```

### **ç¬¬2æ­¥: éƒ¨ç½²åˆçº¦**

```bash
cd D:\
npx hardhat run scripts/deployFixed.js --network sepolia
```

### **ç¬¬3æ­¥: æ›´æ–°é…ç½®**

å¤åˆ¶æ–°åˆçº¦åœ°å€ï¼Œç¼–è¾‘ `public/config.js`

### **ç¬¬4æ­¥: æµ‹è¯•**

åˆ·æ–°é¡µé¢ï¼Œæµ‹è¯•æ‰€æœ‰åŠŸèƒ½

---

## âœ… **æˆåŠŸæ ‡å‡†**

éƒ¨ç½²æˆåŠŸçš„æ ‡å¿—ï¼š

1. âœ… éƒ¨ç½²è„šæœ¬è¾“å‡º "Contract deployed successfully!"
2. âœ… Etherscan ä¸Šå¯ä»¥çœ‹åˆ°æ–°åˆçº¦
3. âœ… å‰ç«¯å¯ä»¥è¿æ¥å¹¶æ˜¾ç¤º "Admin Functions"
4. âœ… å¯ä»¥åˆ›å»ºææ¡ˆ
5. âœ… å¯ä»¥ç»“æŸé›¶æŠ•ç¥¨ææ¡ˆï¼ˆæœ€é‡è¦ï¼ï¼‰
6. âœ… å¯ä»¥è¿ç»­åˆ›å»ºå¤šä¸ªææ¡ˆ

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿè·å–æµ‹è¯•å¸åï¼Œè¿è¡Œéƒ¨ç½²å‘½ä»¤ï¼** ğŸš€

```bash
# ä¸€é”®éƒ¨ç½²
cd D:\ && npx hardhat run scripts/deployFixed.js --network sepolia
```
